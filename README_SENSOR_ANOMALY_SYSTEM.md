# 🚨 센서 이상치 감지 알림 시스템

프로젝트에 특화된 실시간 센서 이상치 감지 및 알림 시스템이 구현되었습니다!

## ✨ 주요 기능

### 🎯 이상치 감지 유형
- **임계값 위반**: 정상/경고/위험 단계별 임계값 초과/미달 감지
- **급격한 변화**: 센서 값의 급격한 상승/하락 감지
- **센서 오작동**: 물리적으로 불가능한 값 감지
- **데이터 누락**: 센서 데이터 수신 중단 감지

### 📊 지원 센서
- **MQ4**: 메탄 가스 센서 (5-60 ppm)
- **MQ136**: 황화수소 가스 센서 (8-70 ppm)
- **MQ137**: 암모니아 가스 센서 (2-45 ppm)
- **온도**: 온도 센서 (5-40°C)
- **습도**: 습도 센서 (10-95%)

### 🔔 알림 방식
- **실시간 브라우저 알림**: Socket.IO 즉시 알림
- **데스크톱 알림**: 브라우저 Notification API
- **알림 소리**: 심각도별 다른 소리
- **시각적 표시**: 헤더 알림 드롭다운

### 📈 심각도 단계
- **🔴 Critical**: 심각한 위험 상황
- **🟠 High**: 높은 위험도
- **🟡 Medium**: 중간 위험도
- **⚠️ Low**: 낮은 위험도

## 🚀 설치 및 설정

### 1. 데이터베이스 설정
```bash
mysql -u [username] -p [database] < database/sensor_anomaly_alerts.sql
```

### 2. 서버 시작
```bash
cd backend
npm start
```

### 3. 프론트엔드 확인
헤더에 센서 이상치 알림 아이콘(🔺)이 표시됩니다!

## 📁 주요 파일 구조

### 백엔드
```
backend/src/
├── services/sensorAnomalyService.js     # 이상치 감지 로직
├── routes/sensorAnomalyRoutes.js        # API 엔드포인트
└── server.js                           # Socket.IO 통합
```

### 프론트엔드
```
frontend/src/
├── services/sensorAlertService.js       # 클라이언트 서비스
├── components/common/SensorAlertDropdown.js  # 알림 드롭다운
├── pages/SensorAlertSettingsPage.js     # 설정 페이지
└── layouts/MainLayout.js               # 레이아웃 통합
```

### 데이터베이스
```
database/
└── sensor_anomaly_alerts.sql           # 테이블 생성 스크립트
```

## 🔧 API 엔드포인트

```
GET    /api/sensor-alerts/alerts              # 알림 목록
GET    /api/sensor-alerts/alerts/unresolved-count  # 미해결 수
PUT    /api/sensor-alerts/alerts/:id/resolve  # 알림 해결
GET    /api/sensor-alerts/thresholds          # 임계값 설정
PUT    /api/sensor-alerts/thresholds/:type    # 임계값 업데이트
GET    /api/sensor-alerts/settings            # 알림 설정
PUT    /api/sensor-alerts/settings            # 알림 설정 업데이트
POST   /api/sensor-alerts/test-alert          # 테스트 알림
GET    /api/sensor-alerts/stats               # 알림 통계
```

## 🧪 테스트 방법

### 1. 브라우저에서 확인
- 헤더 센서 알림 아이콘(🔺) 클릭
- 미해결 알림 수 확인

### 2. 설정 페이지 접근
- `/sensor-alerts/settings` 페이지 방문
- 임계값 및 알림 설정 조정

### 3. 테스트 알림 생성
- 설정 페이지에서 "테스트" 버튼 클릭
- 드롭다운에서 테스트 튜브 아이콘 클릭

### 4. 실시간 이상치 확인
- 서버에서 자동으로 센서 이벤트 발생 (3% 확률)
- 임계값 초과 시 자동 알림 생성

## ⚙️ 설정 가능한 항목

### 센서 임계값
- **정상 범위**: 일반적인 센서 값 범위
- **경고 범위**: 주의가 필요한 범위
- **위험 범위**: 즉시 조치가 필요한 범위
- **급변 임계값**: 급격한 변화 감지 기준

### 알림 설정
- **브라우저 알림**: 데스크톱 알림 활성화
- **알림 소리**: 소리 알림 활성화
- **심각한 알림만**: 중요한 알림만 표시
- **조용한 시간**: 특정 시간대 알림 차단

## 🔄 실시간 작동 방식

1. **센서 데이터 수집**: 2초마다 실시간 센서 데이터 처리
2. **이상치 분석**: 임계값, 급변, 오작동 검사
3. **알림 생성**: 조건 충족 시 데이터베이스에 알림 저장
4. **실시간 전송**: Socket.IO로 모든 클라이언트에 즉시 전송
5. **사용자 알림**: 브라우저 알림 + 소리 + 시각적 표시

## 🎨 UI/UX 특징

- **심각도별 색상**: 빨강(위험) → 주황(높음) → 노랑(중간) → 파랑(낮음)
- **애니메이션**: 미해결 알림 수 깜빡임 효과
- **반응형 디자인**: 모바일/데스크톱 최적화
- **다크모드 지원**: 라이트/다크 테마 지원
- **직관적 아이콘**: 이모지와 Lucide 아이콘 조합

## 🛡️ 보안 및 성능

- **쿨다운 시스템**: 5분간 중복 알림 방지
- **메모리 관리**: 이전 센서 값 Map으로 효율적 저장
- **에러 처리**: 완전한 예외 처리 및 폴백
- **인덱스 최적화**: 데이터베이스 쿼리 성능 최적화

## 📊 데이터베이스 스키마

### sensor_anomaly_alerts
- 센서 이상치 알림 데이터 저장
- 심각도, 센서 타입, 알림 유형별 분류
- 해결 상태 및 시간 추적

### sensor_thresholds
- 센서별 임계값 설정 관리
- 정상/경고/위험 단계별 임계값
- 급격한 변화 감지 임계값

### alert_settings
- 사용자별 알림 설정
- 알림 방식 및 조용한 시간 설정

## 🚀 향후 확장 가능성

- **이메일 알림**: SMTP 연동
- **SMS 알림**: 문자 메시지 전송
- **머신러닝**: AI 기반 이상치 예측
- **대시보드**: 알림 통계 및 분석
- **모바일 앱**: 푸시 알림 지원

---

**센서 이상치 감지 알림 시스템이 완전히 구현되어 즉시 사용 가능합니다!** 🎉

실시간으로 센서 데이터를 모니터링하고 이상치 발생 시 즉시 알림을 받을 수 있습니다. 